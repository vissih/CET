//@version=5
//indicator("Combined Indicator", shorttitle="Combo Indicator", overlay=true)

indicator("Combined Indicator", shorttitle="Combo Indicator", overlay=true, max_lines_count=500, max_labels_count=500)

// Function to plot filled area between two lines
f_area(a, b, color, transp) =>
    var float lineA = na
    var float lineB = na
    if not na(a) and not na(b)
        lineA := a
        lineB := b
    [lineA, lineB]

// Half Trend Indicator
ht_period = 20
ht_mult = 2.0
ht_line = ta.ema(close, ht_period)

// Determine uptrend and downtrend
uptrend = close > ht_line
downtrend = close < ht_line

// Plotting Half Trend
plot(ht_line, color=color.new(color.green, 0), linewidth=2, title="Half Trend")

// Plotting filled area between Half Trend and Close
fill_color = uptrend ? color.new(color.green, 80) : color.new(color.red, 80)
[filledA, filledB] = f_area(ht_line, close, fill_color, 70)
fill(plot(filledA), plot(filledB), color=fill_color)
